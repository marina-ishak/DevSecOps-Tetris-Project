{"ast":null,"code":"import _objectSpread from \"/Users/davidnabilgerges/Downloads/End-to-End-Kubernetes-DevSecOps-Tetris-Project/Tetris-V2/node_modules/@babel/runtime/helpers/esm/objectSpread2\";\nimport _slicedToArray from \"/Users/davidnabilgerges/Downloads/End-to-End-Kubernetes-DevSecOps-Tetris-Project/Tetris-V2/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nimport _toConsumableArray from \"/Users/davidnabilgerges/Downloads/End-to-End-Kubernetes-DevSecOps-Tetris-Project/Tetris-V2/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\nvar _jsxFileName = \"/Users/davidnabilgerges/Downloads/End-to-End-Kubernetes-DevSecOps-Tetris-Project/Tetris-V2/src/components/Game/index.js\";\nimport React, { useState, useEffect } from \"react\";\nimport { useDrag } from \"react-use-gesture\";\nimport BarLoader from \"react-spinners/BarLoader\";\nimport Stage from \"../Stage\";\nimport { useInterval } from \"../../hooks/useInterval\";\nimport Center from \"../Center\";\nimport { PrintPlayerInMap } from \"../../utils/Utils\"; //TODO: Alterar OnClick (rotatePlayer) para OnFastClick (criar hook)\n//TODO: Organização do componente \"Game\" (Separar codigo em hooks, outros components e funcoes)\n//TODO: Dar um tempo quando o bloco estiver no chão, mas o usuário mexendo\n\nvar STAGE_HEIGHT = 18;\nvar STAGE_WIDTH = 10;\n\nvar initialMap = _toConsumableArray(new Array(STAGE_HEIGHT)).map(function () {\n  return _toConsumableArray(new Array(STAGE_WIDTH)).map(function () {\n    return {\n      fill: 0,\n      color: []\n    };\n  });\n});\n\nvar colors = [\"#e54b4b\", \"#9a031e\", \"#fcdc4d\", \"#005397\", \"#0bbcd6\", \"#20ad65\", \"#f8ebee\"];\nvar I = {\n  bloco: [[0, 0, 0, 0], [1, 1, 1, 1], [0, 0, 0, 0], [0, 0, 0, 0]]\n};\nvar O = {\n  bloco: [[1, 1], [1, 1]]\n};\nvar T = {\n  bloco: [[0, 0, 0], [1, 1, 1], [0, 1, 0]]\n};\nvar J = {\n  bloco: [[0, 1, 0], [0, 1, 0], [1, 1, 0]]\n};\nvar L = {\n  bloco: [[0, 1, 0], [0, 1, 0], [0, 1, 1]]\n};\nvar S = {\n  bloco: [[0, 1, 1], [1, 1, 0], [0, 0, 0]]\n};\nvar Z = {\n  bloco: [[1, 1, 0], [0, 1, 1], [0, 0, 0]]\n};\n\nvar getRandomBloco = function getRandomBloco() {\n  var blocos = [I, O, T, J, L, S, Z];\n  var bloco = blocos[Math.floor(Math.random() * blocos.length)];\n  bloco.color = colors[Math.floor(Math.random() * colors.length)];\n  return bloco;\n};\n\nvar getRandomPlayer = function getRandomPlayer(player) {\n  var bloco, next;\n  if (player) if (player.next) {\n    bloco = JSON.parse(JSON.stringify(player.next));\n    next = getRandomBloco();\n  }\n  if (!bloco) bloco = getRandomBloco();\n  if (!next) next = getRandomBloco();\n  var pos = [0, Math.floor(STAGE_WIDTH / 2 - 2 / 2)];\n  return {\n    pos: pos,\n    bloco: bloco,\n    next: next\n  };\n};\n\nvar Game = function Game() {\n  var _useState = useState(initialMap),\n      _useState2 = _slicedToArray(_useState, 2),\n      map = _useState2[0],\n      setMap = _useState2[1];\n\n  var _useState3 = useState(),\n      _useState4 = _slicedToArray(_useState3, 2),\n      player = _useState4[0],\n      setPlayer = _useState4[1];\n\n  var _useState5 = useState(false),\n      _useState6 = _slicedToArray(_useState5, 2),\n      down = _useState6[0],\n      setDown = _useState6[1];\n\n  var _useState7 = useState(false),\n      _useState8 = _slicedToArray(_useState7, 2),\n      pause = _useState8[0],\n      setPause = _useState8[1];\n\n  var _useState9 = useState(Date.now()),\n      _useState10 = _slicedToArray(_useState9, 2),\n      tick = _useState10[0],\n      setTick = _useState10[1];\n\n  var _useState11 = useState(),\n      _useState12 = _slicedToArray(_useState11, 2),\n      hintPlayer = _useState12[0],\n      setHintPlayer = _useState12[1];\n\n  var _useState13 = useState(true),\n      _useState14 = _slicedToArray(_useState13, 2),\n      spaceReleased = _useState14[0],\n      setSpaceReleased = _useState14[1];\n\n  var _useState15 = useState(0),\n      _useState16 = _slicedToArray(_useState15, 2),\n      lines = _useState16[0],\n      setlines = _useState16[1];\n\n  var _useState17 = useState(0),\n      _useState18 = _slicedToArray(_useState17, 2),\n      score = _useState18[0],\n      setScore = _useState18[1];\n\n  var _useState19 = useState(1),\n      _useState20 = _slicedToArray(_useState19, 2),\n      level = _useState20[0],\n      setLevel = _useState20[1];\n\n  var _useState21 = useState(0),\n      _useState22 = _slicedToArray(_useState21, 2),\n      dragX = _useState22[0],\n      setDragX = _useState22[1];\n\n  var _useState23 = useState(0),\n      _useState24 = _slicedToArray(_useState23, 2),\n      dragY = _useState24[0],\n      setDragY = _useState24[1];\n\n  var _useState25 = useState(false),\n      _useState26 = _slicedToArray(_useState25, 2),\n      gameOver = _useState26[0],\n      setGameOver = _useState26[1];\n\n  useEffect(function () {\n    var levelBaseScore = 1000;\n    var nextLevel = level + 1;\n    var nextLevelScore = levelBaseScore * nextLevel * nextLevel * nextLevel / 5;\n    console.log(\"Current level: \", level);\n    console.log(\"Score to next level:\", nextLevelScore);\n    console.log(\"Remaining: \", nextLevelScore - score);\n    if (score >= nextLevelScore) setLevel(level + 1);\n  }, [level, score]);\n\n  var restartGame = function restartGame() {\n    setMap(initialMap); //TODO: lose game\n\n    setlines(0);\n    setScore(0);\n    setLevel(1);\n    setGameOver(false);\n  };\n\n  var loseGame = function loseGame() {\n    setGameOver(true);\n  };\n\n  var drop = function drop() {\n    if (!player) {\n      setPlayer(getRandomPlayer());\n      return;\n    }\n\n    setPlayer(function (player) {\n      var newPos = getNewPlayerPos(\"down\");\n\n      if (player.pos === newPos) {\n        setMap(function (map) {\n          var mapWithPlayer = PrintPlayerInMap(player, map);\n          var mapCleared = checkMap(mapWithPlayer);\n          return mapCleared;\n        });\n        var newPlayer = getRandomPlayer(player);\n        if (!validatePosition(newPlayer.pos, newPlayer.bloco)) loseGame();\n        return newPlayer;\n      }\n\n      return _objectSpread({}, player, {\n        pos: newPos\n      });\n    });\n  };\n\n  var rotatePlayer = function rotatePlayer() {\n    var clonedPlayer = JSON.parse(JSON.stringify(player));\n    var mtrx = clonedPlayer.bloco.bloco.map(function (_, index) {\n      return clonedPlayer.bloco.bloco.map(function (column) {\n        return column[index];\n      });\n    });\n    mtrx = mtrx.map(function (row) {\n      return row.reverse();\n    });\n    if (validatePosition(player.pos, {\n      bloco: mtrx\n    })) setPlayer(_objectSpread({}, player, {\n      bloco: _objectSpread({}, player.bloco, {\n        bloco: mtrx\n      })\n    }));\n  };\n\n  var keyUp = function keyUp(_ref) {\n    var keyCode = _ref.keyCode;\n    if (pause || gameOver) return;\n    var THRESHOLD = 80; // Activate the interval again when user releases down arrow.\n\n    if (keyCode === 40) {\n      setDown(false);\n      if (Date.now() - tick <= THRESHOLD) drop();\n    }\n\n    if (keyCode === 32) setSpaceReleased(true);\n  };\n\n  var forwardDown = function forwardDown() {\n    if (pause || gameOver) return;\n    setPlayer(function (player) {\n      var playerCopy = JSON.parse(JSON.stringify(player));\n      playerCopy.pos = _toConsumableArray(hintPlayer.pos);\n      setMap(function (map) {\n        var mapWithPlayer = PrintPlayerInMap(playerCopy, map);\n        var mapCleared = checkMap(mapWithPlayer);\n        return mapCleared;\n      });\n      var newPlayer = getRandomPlayer(player);\n      if (!validatePosition(newPlayer.pos, newPlayer.bloco)) loseGame();\n      return newPlayer;\n    });\n  };\n\n  var keyDown = function keyDown(_ref2) {\n    var keyCode = _ref2.keyCode;\n    if (pause || gameOver) return;\n\n    switch (keyCode) {\n      case 37:\n        setPlayer(function (player) {\n          return _objectSpread({}, player, {\n            pos: getNewPlayerPos(\"left\")\n          });\n        });\n        break;\n\n      case 38:\n        rotatePlayer();\n        break;\n\n      case 39:\n        setPlayer(function (player) {\n          return _objectSpread({}, player, {\n            pos: getNewPlayerPos(\"right\")\n          });\n        });\n        break;\n\n      case 40:\n        setTick(Date.now());\n        setDown(true);\n        break;\n\n      case 32:\n        if (spaceReleased) {\n          setSpaceReleased(false);\n          forwardDown();\n        }\n\n        break;\n\n      default:\n        break;\n    }\n  };\n\n  var checkMap = React.useCallback(function (map) {\n    var rowsClear = [];\n    map.forEach(function (row, y) {\n      var clear = true;\n      row.forEach(function (pixel, x) {\n        if (pixel.fill === 0) clear = false;\n      });\n      if (clear) rowsClear.push(y);\n    });\n\n    if (rowsClear.length > 0) {\n      var newMap = map.slice();\n      rowsClear.forEach(function (y) {\n        for (var mapY = newMap.length - 1; mapY >= 0; mapY--) {\n          if (mapY <= y) if (mapY > 0) newMap[mapY] = newMap[mapY - 1];else newMap[mapY] = _toConsumableArray(new Array(STAGE_WIDTH)).map(function () {\n            return {\n              fill: 0,\n              color: []\n            };\n          });\n        }\n      });\n      setlines(function (quant) {\n        return quant + rowsClear.length;\n      });\n      var bonusLevel = 100 * (level * level);\n      var bonusRows = 40 * (rowsClear.length * rowsClear.length - 1);\n      setScore(function (score) {\n        return score + 300 * rowsClear.length + bonusRows + bonusLevel;\n      });\n      return newMap;\n    }\n\n    return map;\n  }, [level]);\n  var validatePosition = React.useCallback(function (pos, bloco) {\n    for (var y = 0; y < bloco.bloco.length; y++) {\n      for (var x = 0; x < bloco.bloco[y].length; x++) {\n        if (bloco.bloco[y][x] === 1) {\n          var mapY = pos[0] + y;\n          var mapX = pos[1] + x;\n          if (mapY > STAGE_HEIGHT || mapX < 0 || mapX > STAGE_WIDTH || !map[mapY] || !map[mapY][mapX] || map[mapY][mapX].fill === 1) return false;\n        }\n      }\n    }\n\n    return true;\n  }, [map]);\n  var calculateHintPlayer = React.useCallback(function (player) {\n    var hintBloco = JSON.parse(JSON.stringify(player.bloco));\n\n    var hintPosition = _toConsumableArray(player.pos);\n\n    while (validatePosition([hintPosition[0] + 1, hintPosition[1]], hintBloco)) {\n      hintPosition = [hintPosition[0] + 1, hintPosition[1]];\n    }\n\n    return {\n      pos: hintPosition,\n      bloco: hintBloco\n    };\n  }, [validatePosition]);\n  var getNewPlayerPos = React.useCallback(function (movement) {\n    var newPos;\n    if (!player) return;\n    if (movement === \"down\") newPos = [player.pos[0] + 1, player.pos[1]];\n    if (movement === \"left\") newPos = [player.pos[0], player.pos[1] - 1];\n    if (movement === \"right\") newPos = [player.pos[0], player.pos[1] + 1];\n    if (!validatePosition(newPos, player.bloco)) return player.pos;\n    return newPos;\n  }, [player, validatePosition]);\n  useInterval(function () {\n    drop();\n  }, pause || gameOver ? null : down ? 50 : 450 - (level - 1) * 20);\n  useEffect(function () {\n    if (!player) return;\n    setHintPlayer(calculateHintPlayer(player));\n  }, [player, calculateHintPlayer]);\n  var bind = useDrag(function (_ref3) {\n    var down = _ref3.down,\n        _ref3$movement = _slicedToArray(_ref3.movement, 2),\n        mx = _ref3$movement[0],\n        my = _ref3$movement[1],\n        velocity = _ref3.velocity;\n\n    var THRESHOLD = 20;\n    var FORCE_THRESHOLD = 1;\n\n    if (down) {\n      if (Math.abs(mx - dragX) > THRESHOLD) {\n        if (mx - dragX > 0) setPlayer(function (player) {\n          return _objectSpread({}, player, {\n            pos: getNewPlayerPos(\"right\")\n          });\n        });else setPlayer(function (player) {\n          return _objectSpread({}, player, {\n            pos: getNewPlayerPos(\"left\")\n          });\n        });\n        setDragX(mx);\n      }\n\n      if (Math.abs(my - dragY) > THRESHOLD) {\n        if (velocity > FORCE_THRESHOLD) {\n          if (spaceReleased) {\n            setSpaceReleased(false);\n            forwardDown();\n          }\n        } else if (my - dragY > 0) drop();\n\n        setDragY(my);\n      }\n    } else {\n      setDragX(0);\n      setDragY(0);\n      setSpaceReleased(true);\n    }\n  }, {\n    filterTaps: true,\n    lockDirection: true\n  });\n  if (!player || !map || !hintPlayer) return React.createElement(Center, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 355\n    },\n    __self: this\n  }, React.createElement(BarLoader, {\n    color: \"#C41212\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 356\n    },\n    __self: this\n  }));\n  return React.createElement(Stage, Object.assign({\n    lose: gameOver,\n    restartClick: function restartClick() {\n      return restartGame();\n    },\n    map: map,\n    player: player,\n    hint: hintPlayer,\n    paused: pause,\n    status: {\n      lines: lines,\n      score: score,\n      level: level\n    },\n    onBlur: function onBlur() {\n      return setPause(true);\n    },\n    onFocus: function onFocus() {\n      return setPause(false);\n    },\n    tabIndex: \"0\",\n    onKeyUp: keyUp,\n    onKeyDown: keyDown,\n    onClick: function onClick() {\n      return rotatePlayer();\n    }\n  }, bind(), {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 360\n    },\n    __self: this\n  }));\n};\n\nexport default Game;","map":{"version":3,"sources":["/Users/davidnabilgerges/Downloads/End-to-End-Kubernetes-DevSecOps-Tetris-Project/Tetris-V2/src/components/Game/index.js"],"names":["React","useState","useEffect","useDrag","BarLoader","Stage","useInterval","Center","PrintPlayerInMap","STAGE_HEIGHT","STAGE_WIDTH","initialMap","Array","map","fill","color","colors","I","bloco","O","T","J","L","S","Z","getRandomBloco","blocos","Math","floor","random","length","getRandomPlayer","player","next","JSON","parse","stringify","pos","Game","setMap","setPlayer","down","setDown","pause","setPause","Date","now","tick","setTick","hintPlayer","setHintPlayer","spaceReleased","setSpaceReleased","lines","setlines","score","setScore","level","setLevel","dragX","setDragX","dragY","setDragY","gameOver","setGameOver","levelBaseScore","nextLevel","nextLevelScore","console","log","restartGame","loseGame","drop","newPos","getNewPlayerPos","mapWithPlayer","mapCleared","checkMap","newPlayer","validatePosition","rotatePlayer","clonedPlayer","mtrx","_","index","column","row","reverse","keyUp","keyCode","THRESHOLD","forwardDown","playerCopy","keyDown","useCallback","rowsClear","forEach","y","clear","pixel","x","push","newMap","slice","mapY","quant","bonusLevel","bonusRows","mapX","calculateHintPlayer","hintBloco","hintPosition","movement","bind","mx","my","velocity","FORCE_THRESHOLD","abs","filterTaps","lockDirection"],"mappings":";;;;AAAA,OAAOA,KAAP,IAAgBC,QAAhB,EAA0BC,SAA1B,QAA2C,OAA3C;AACA,SAASC,OAAT,QAAwB,mBAAxB;AACA,OAAOC,SAAP,MAAsB,0BAAtB;AAEA,OAAOC,KAAP,MAAkB,UAAlB;AACA,SAASC,WAAT,QAA4B,yBAA5B;AACA,OAAOC,MAAP,MAAmB,WAAnB;AAEA,SAASC,gBAAT,QAAiC,mBAAjC,C,CAEA;AACA;AACA;;AAEA,IAAMC,YAAY,GAAG,EAArB;AACA,IAAMC,WAAW,GAAG,EAApB;;AAEA,IAAMC,UAAU,GAAG,mBAAI,IAAIC,KAAJ,CAAUH,YAAV,CAAJ,EAA6BI,GAA7B,CAAiC;AAAA,SACnD,mBAAI,IAAID,KAAJ,CAAUF,WAAV,CAAJ,EAA4BG,GAA5B,CAAgC;AAAA,WAAO;AAAEC,MAAAA,IAAI,EAAE,CAAR;AAAWC,MAAAA,KAAK,EAAE;AAAlB,KAAP;AAAA,GAAhC,CADmD;AAAA,CAAjC,CAAnB;;AAIA,IAAMC,MAAM,GAAG,CACd,SADc,EAEd,SAFc,EAGd,SAHc,EAId,SAJc,EAKd,SALc,EAMd,SANc,EAOd,SAPc,CAAf;AAUA,IAAMC,CAAC,GAAG;AACTC,EAAAA,KAAK,EAAE,CACN,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,EAAU,CAAV,CADM,EAEN,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,EAAU,CAAV,CAFM,EAGN,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,EAAU,CAAV,CAHM,EAIN,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,EAAU,CAAV,CAJM;AADE,CAAV;AASA,IAAMC,CAAC,GAAG;AACTD,EAAAA,KAAK,EAAE,CACN,CAAC,CAAD,EAAI,CAAJ,CADM,EAEN,CAAC,CAAD,EAAI,CAAJ,CAFM;AADE,CAAV;AAOA,IAAME,CAAC,GAAG;AACTF,EAAAA,KAAK,EAAE,CACN,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,CADM,EAEN,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,CAFM,EAGN,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,CAHM;AADE,CAAV;AAQA,IAAMG,CAAC,GAAG;AACTH,EAAAA,KAAK,EAAE,CACN,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,CADM,EAEN,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,CAFM,EAGN,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,CAHM;AADE,CAAV;AAQA,IAAMI,CAAC,GAAG;AACTJ,EAAAA,KAAK,EAAE,CACN,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,CADM,EAEN,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,CAFM,EAGN,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,CAHM;AADE,CAAV;AAQA,IAAMK,CAAC,GAAG;AACTL,EAAAA,KAAK,EAAE,CACN,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,CADM,EAEN,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,CAFM,EAGN,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,CAHM;AADE,CAAV;AAQA,IAAMM,CAAC,GAAG;AACTN,EAAAA,KAAK,EAAE,CACN,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,CADM,EAEN,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,CAFM,EAGN,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,CAHM;AADE,CAAV;;AAQA,IAAMO,cAAc,GAAG,SAAjBA,cAAiB,GAAM;AAC5B,MAAMC,MAAM,GAAG,CAACT,CAAD,EAAIE,CAAJ,EAAOC,CAAP,EAAUC,CAAV,EAAaC,CAAb,EAAgBC,CAAhB,EAAmBC,CAAnB,CAAf;AACA,MAAMN,KAAK,GAAGQ,MAAM,CAACC,IAAI,CAACC,KAAL,CAAWD,IAAI,CAACE,MAAL,KAAgBH,MAAM,CAACI,MAAlC,CAAD,CAApB;AACAZ,EAAAA,KAAK,CAACH,KAAN,GAAcC,MAAM,CAACW,IAAI,CAACC,KAAL,CAAWD,IAAI,CAACE,MAAL,KAAgBb,MAAM,CAACc,MAAlC,CAAD,CAApB;AACA,SAAOZ,KAAP;AACA,CALD;;AAMA,IAAMa,eAAe,GAAG,SAAlBA,eAAkB,CAAAC,MAAM,EAAI;AACjC,MAAId,KAAJ,EAAWe,IAAX;AACA,MAAID,MAAJ,EACC,IAAIA,MAAM,CAACC,IAAX,EAAiB;AAChBf,IAAAA,KAAK,GAAGgB,IAAI,CAACC,KAAL,CAAWD,IAAI,CAACE,SAAL,CAAeJ,MAAM,CAACC,IAAtB,CAAX,CAAR;AACAA,IAAAA,IAAI,GAAGR,cAAc,EAArB;AACA;AACF,MAAI,CAACP,KAAL,EAAYA,KAAK,GAAGO,cAAc,EAAtB;AACZ,MAAI,CAACQ,IAAL,EAAWA,IAAI,GAAGR,cAAc,EAArB;AACX,MAAMY,GAAG,GAAG,CAAC,CAAD,EAAIV,IAAI,CAACC,KAAL,CAAWlB,WAAW,GAAG,CAAd,GAAkB,IAAI,CAAjC,CAAJ,CAAZ;AACA,SAAO;AAAE2B,IAAAA,GAAG,EAAHA,GAAF;AAAOnB,IAAAA,KAAK,EAALA,KAAP;AAAce,IAAAA,IAAI,EAAJA;AAAd,GAAP;AACA,CAXD;;AAaA,IAAMK,IAAI,GAAG,SAAPA,IAAO,GAAM;AAAA,kBACIrC,QAAQ,CAACU,UAAD,CADZ;AAAA;AAAA,MACXE,GADW;AAAA,MACN0B,MADM;;AAAA,mBAEUtC,QAAQ,EAFlB;AAAA;AAAA,MAEX+B,MAFW;AAAA,MAEHQ,SAFG;;AAAA,mBAGMvC,QAAQ,CAAC,KAAD,CAHd;AAAA;AAAA,MAGXwC,IAHW;AAAA,MAGLC,OAHK;;AAAA,mBAIQzC,QAAQ,CAAC,KAAD,CAJhB;AAAA;AAAA,MAIX0C,KAJW;AAAA,MAIJC,QAJI;;AAAA,mBAKM3C,QAAQ,CAAC4C,IAAI,CAACC,GAAL,EAAD,CALd;AAAA;AAAA,MAKXC,IALW;AAAA,MAKLC,OALK;;AAAA,oBAMkB/C,QAAQ,EAN1B;AAAA;AAAA,MAMXgD,UANW;AAAA,MAMCC,aAND;;AAAA,oBAOwBjD,QAAQ,CAAC,IAAD,CAPhC;AAAA;AAAA,MAOXkD,aAPW;AAAA,MAOIC,gBAPJ;;AAAA,oBAQQnD,QAAQ,CAAC,CAAD,CARhB;AAAA;AAAA,MAQXoD,KARW;AAAA,MAQJC,QARI;;AAAA,oBASQrD,QAAQ,CAAC,CAAD,CAThB;AAAA;AAAA,MASXsD,KATW;AAAA,MASJC,QATI;;AAAA,oBAUQvD,QAAQ,CAAC,CAAD,CAVhB;AAAA;AAAA,MAUXwD,KAVW;AAAA,MAUJC,QAVI;;AAAA,oBAWQzD,QAAQ,CAAC,CAAD,CAXhB;AAAA;AAAA,MAWX0D,KAXW;AAAA,MAWJC,QAXI;;AAAA,oBAYQ3D,QAAQ,CAAC,CAAD,CAZhB;AAAA;AAAA,MAYX4D,KAZW;AAAA,MAYJC,QAZI;;AAAA,oBAac7D,QAAQ,CAAC,KAAD,CAbtB;AAAA;AAAA,MAaX8D,QAbW;AAAA,MAaDC,WAbC;;AAelB9D,EAAAA,SAAS,CAAC,YAAM;AACf,QAAM+D,cAAc,GAAG,IAAvB;AACA,QAAMC,SAAS,GAAGT,KAAK,GAAG,CAA1B;AACA,QAAMU,cAAc,GAClBF,cAAc,GAAGC,SAAjB,GAA6BA,SAA7B,GAAyCA,SAA1C,GAAuD,CADxD;AAEAE,IAAAA,OAAO,CAACC,GAAR,CAAY,iBAAZ,EAA+BZ,KAA/B;AACAW,IAAAA,OAAO,CAACC,GAAR,CAAY,sBAAZ,EAAoCF,cAApC;AACAC,IAAAA,OAAO,CAACC,GAAR,CAAY,aAAZ,EAA2BF,cAAc,GAAGZ,KAA5C;AACA,QAAIA,KAAK,IAAIY,cAAb,EAA6BT,QAAQ,CAACD,KAAK,GAAG,CAAT,CAAR;AAC7B,GATQ,EASN,CAACA,KAAD,EAAQF,KAAR,CATM,CAAT;;AAWA,MAAMe,WAAW,GAAG,SAAdA,WAAc,GAAM;AACzB/B,IAAAA,MAAM,CAAC5B,UAAD,CAAN,CADyB,CACL;;AACpB2C,IAAAA,QAAQ,CAAC,CAAD,CAAR;AACAE,IAAAA,QAAQ,CAAC,CAAD,CAAR;AACAE,IAAAA,QAAQ,CAAC,CAAD,CAAR;AACAM,IAAAA,WAAW,CAAC,KAAD,CAAX;AACA,GAND;;AAQA,MAAMO,QAAQ,GAAG,SAAXA,QAAW,GAAM;AACtBP,IAAAA,WAAW,CAAC,IAAD,CAAX;AACA,GAFD;;AAIA,MAAMQ,IAAI,GAAG,SAAPA,IAAO,GAAM;AAClB,QAAI,CAACxC,MAAL,EAAa;AACZQ,MAAAA,SAAS,CAACT,eAAe,EAAhB,CAAT;AACA;AACA;;AACDS,IAAAA,SAAS,CAAC,UAAAR,MAAM,EAAI;AACnB,UAAMyC,MAAM,GAAGC,eAAe,CAAC,MAAD,CAA9B;;AACA,UAAI1C,MAAM,CAACK,GAAP,KAAeoC,MAAnB,EAA2B;AAC1BlC,QAAAA,MAAM,CAAC,UAAA1B,GAAG,EAAI;AACb,cAAM8D,aAAa,GAAGnE,gBAAgB,CAACwB,MAAD,EAASnB,GAAT,CAAtC;AACA,cAAM+D,UAAU,GAAGC,QAAQ,CAACF,aAAD,CAA3B;AACA,iBAAOC,UAAP;AACA,SAJK,CAAN;AAKA,YAAME,SAAS,GAAG/C,eAAe,CAACC,MAAD,CAAjC;AACA,YAAI,CAAC+C,gBAAgB,CAACD,SAAS,CAACzC,GAAX,EAAgByC,SAAS,CAAC5D,KAA1B,CAArB,EAAuDqD,QAAQ;AAC/D,eAAOO,SAAP;AACA;;AACD,+BAAY9C,MAAZ;AAAoBK,QAAAA,GAAG,EAAEoC;AAAzB;AACA,KAbQ,CAAT;AAcA,GAnBD;;AAqBA,MAAMO,YAAY,GAAG,SAAfA,YAAe,GAAM;AAC1B,QAAMC,YAAY,GAAG/C,IAAI,CAACC,KAAL,CAAWD,IAAI,CAACE,SAAL,CAAeJ,MAAf,CAAX,CAArB;AACA,QAAIkD,IAAI,GAAGD,YAAY,CAAC/D,KAAb,CAAmBA,KAAnB,CAAyBL,GAAzB,CAA6B,UAACsE,CAAD,EAAIC,KAAJ;AAAA,aACvCH,YAAY,CAAC/D,KAAb,CAAmBA,KAAnB,CAAyBL,GAAzB,CAA6B,UAAAwE,MAAM;AAAA,eAAIA,MAAM,CAACD,KAAD,CAAV;AAAA,OAAnC,CADuC;AAAA,KAA7B,CAAX;AAGAF,IAAAA,IAAI,GAAGA,IAAI,CAACrE,GAAL,CAAS,UAAAyE,GAAG;AAAA,aAAIA,GAAG,CAACC,OAAJ,EAAJ;AAAA,KAAZ,CAAP;AACA,QAAIR,gBAAgB,CAAC/C,MAAM,CAACK,GAAR,EAAa;AAAEnB,MAAAA,KAAK,EAAEgE;AAAT,KAAb,CAApB,EACC1C,SAAS,mBAAMR,MAAN;AAAcd,MAAAA,KAAK,oBAAOc,MAAM,CAACd,KAAd;AAAqBA,QAAAA,KAAK,EAAEgE;AAA5B;AAAnB,OAAT;AACD,GARD;;AAUA,MAAMM,KAAK,GAAG,SAARA,KAAQ,OAAiB;AAAA,QAAdC,OAAc,QAAdA,OAAc;AAC9B,QAAI9C,KAAK,IAAIoB,QAAb,EACC;AACD,QAAM2B,SAAS,GAAG,EAAlB,CAH8B,CAI9B;;AACA,QAAID,OAAO,KAAK,EAAhB,EAAoB;AACnB/C,MAAAA,OAAO,CAAC,KAAD,CAAP;AACA,UAAIG,IAAI,CAACC,GAAL,KAAaC,IAAb,IAAqB2C,SAAzB,EAAoClB,IAAI;AACxC;;AACD,QAAIiB,OAAO,KAAK,EAAhB,EAAoBrC,gBAAgB,CAAC,IAAD,CAAhB;AACpB,GAVD;;AAYA,MAAMuC,WAAW,GAAG,SAAdA,WAAc,GAAM;AACzB,QAAIhD,KAAK,IAAIoB,QAAb,EACC;AACDvB,IAAAA,SAAS,CAAC,UAAAR,MAAM,EAAI;AACnB,UAAM4D,UAAU,GAAG1D,IAAI,CAACC,KAAL,CAAWD,IAAI,CAACE,SAAL,CAAeJ,MAAf,CAAX,CAAnB;AACA4D,MAAAA,UAAU,CAACvD,GAAX,sBAAqBY,UAAU,CAACZ,GAAhC;AACAE,MAAAA,MAAM,CAAC,UAAA1B,GAAG,EAAI;AACb,YAAM8D,aAAa,GAAGnE,gBAAgB,CAACoF,UAAD,EAAa/E,GAAb,CAAtC;AACA,YAAM+D,UAAU,GAAGC,QAAQ,CAACF,aAAD,CAA3B;AACA,eAAOC,UAAP;AACA,OAJK,CAAN;AAKA,UAAME,SAAS,GAAG/C,eAAe,CAACC,MAAD,CAAjC;AACA,UAAI,CAAC+C,gBAAgB,CAACD,SAAS,CAACzC,GAAX,EAAgByC,SAAS,CAAC5D,KAA1B,CAArB,EAAuDqD,QAAQ;AAC/D,aAAOO,SAAP;AACA,KAXQ,CAAT;AAYA,GAfD;;AAiBA,MAAMe,OAAO,GAAG,SAAVA,OAAU,QAAiB;AAAA,QAAdJ,OAAc,SAAdA,OAAc;AAChC,QAAI9C,KAAK,IAAIoB,QAAb,EACC;;AACD,YAAQ0B,OAAR;AACC,WAAK,EAAL;AACCjD,QAAAA,SAAS,CAAC,UAAAR,MAAM;AAAA,mCAAUA,MAAV;AAAkBK,YAAAA,GAAG,EAAEqC,eAAe,CAAC,MAAD;AAAtC;AAAA,SAAP,CAAT;AACA;;AACD,WAAK,EAAL;AACCM,QAAAA,YAAY;AACZ;;AACD,WAAK,EAAL;AACCxC,QAAAA,SAAS,CAAC,UAAAR,MAAM;AAAA,mCAAUA,MAAV;AAAkBK,YAAAA,GAAG,EAAEqC,eAAe,CAAC,OAAD;AAAtC;AAAA,SAAP,CAAT;AACA;;AACD,WAAK,EAAL;AACC1B,QAAAA,OAAO,CAACH,IAAI,CAACC,GAAL,EAAD,CAAP;AACAJ,QAAAA,OAAO,CAAC,IAAD,CAAP;AACA;;AACD,WAAK,EAAL;AACC,YAAIS,aAAJ,EAAmB;AAClBC,UAAAA,gBAAgB,CAAC,KAAD,CAAhB;AACAuC,UAAAA,WAAW;AACX;;AACD;;AACD;AACC;AArBF;AAuBA,GA1BD;;AA4BA,MAAMd,QAAQ,GAAG7E,KAAK,CAAC8F,WAAN,CAChB,UAAAjF,GAAG,EAAI;AACN,QAAIkF,SAAS,GAAG,EAAhB;AACAlF,IAAAA,GAAG,CAACmF,OAAJ,CAAY,UAACV,GAAD,EAAMW,CAAN,EAAY;AACvB,UAAIC,KAAK,GAAG,IAAZ;AACAZ,MAAAA,GAAG,CAACU,OAAJ,CAAY,UAACG,KAAD,EAAQC,CAAR,EAAc;AACzB,YAAID,KAAK,CAACrF,IAAN,KAAe,CAAnB,EAAsBoF,KAAK,GAAG,KAAR;AACtB,OAFD;AAGA,UAAIA,KAAJ,EAAWH,SAAS,CAACM,IAAV,CAAeJ,CAAf;AACX,KAND;;AAOA,QAAIF,SAAS,CAACjE,MAAV,GAAmB,CAAvB,EAA0B;AACzB,UAAIwE,MAAM,GAAGzF,GAAG,CAAC0F,KAAJ,EAAb;AACAR,MAAAA,SAAS,CAACC,OAAV,CAAkB,UAAAC,CAAC,EAAI;AACtB,aAAK,IAAIO,IAAI,GAAGF,MAAM,CAACxE,MAAP,GAAgB,CAAhC,EAAmC0E,IAAI,IAAI,CAA3C,EAA8CA,IAAI,EAAlD;AACC,cAAIA,IAAI,IAAIP,CAAZ,EACC,IAAIO,IAAI,GAAG,CAAX,EAAcF,MAAM,CAACE,IAAD,CAAN,GAAeF,MAAM,CAACE,IAAI,GAAG,CAAR,CAArB,CAAd,KAECF,MAAM,CAACE,IAAD,CAAN,GAAe,mBAAI,IAAI5F,KAAJ,CAAUF,WAAV,CAAJ,EAA4BG,GAA5B,CAAgC;AAAA,mBAAO;AACrDC,cAAAA,IAAI,EAAE,CAD+C;AAErDC,cAAAA,KAAK,EAAE;AAF8C,aAAP;AAAA,WAAhC,CAAf;AAJH;AAQA,OATD;AAUAuC,MAAAA,QAAQ,CAAC,UAAAmD,KAAK;AAAA,eAAIA,KAAK,GAAGV,SAAS,CAACjE,MAAtB;AAAA,OAAN,CAAR;AACA,UAAM4E,UAAU,GAAG,OAAOjD,KAAK,GAAGA,KAAf,CAAnB;AACA,UAAMkD,SAAS,GAAG,MAAMZ,SAAS,CAACjE,MAAV,GAAmBiE,SAAS,CAACjE,MAA7B,GAAsC,CAA5C,CAAlB;AACA0B,MAAAA,QAAQ,CAAC,UAAAD,KAAK;AAAA,eAAIA,KAAK,GAAG,MAAMwC,SAAS,CAACjE,MAAxB,GAAiC6E,SAAjC,GAA6CD,UAAjD;AAAA,OAAN,CAAR;AACA,aAAOJ,MAAP;AACA;;AACD,WAAOzF,GAAP;AACA,GA7Be,EA8BhB,CAAC4C,KAAD,CA9BgB,CAAjB;AAiCA,MAAMsB,gBAAgB,GAAG/E,KAAK,CAAC8F,WAAN,CACxB,UAACzD,GAAD,EAAMnB,KAAN,EAAgB;AACf,SAAK,IAAI+E,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG/E,KAAK,CAACA,KAAN,CAAYY,MAAhC,EAAwCmE,CAAC,EAAzC;AACC,WAAK,IAAIG,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGlF,KAAK,CAACA,KAAN,CAAY+E,CAAZ,EAAenE,MAAnC,EAA2CsE,CAAC,EAA5C;AACC,YAAIlF,KAAK,CAACA,KAAN,CAAY+E,CAAZ,EAAeG,CAAf,MAAsB,CAA1B,EAA6B;AAC5B,cAAII,IAAI,GAAGnE,GAAG,CAAC,CAAD,CAAH,GAAS4D,CAApB;AACA,cAAIW,IAAI,GAAGvE,GAAG,CAAC,CAAD,CAAH,GAAS+D,CAApB;AACA,cACCI,IAAI,GAAG/F,YAAP,IACAmG,IAAI,GAAG,CADP,IAEAA,IAAI,GAAGlG,WAFP,IAGA,CAACG,GAAG,CAAC2F,IAAD,CAHJ,IAIA,CAAC3F,GAAG,CAAC2F,IAAD,CAAH,CAAUI,IAAV,CAJD,IAKA/F,GAAG,CAAC2F,IAAD,CAAH,CAAUI,IAAV,EAAgB9F,IAAhB,KAAyB,CAN1B,EAQC,OAAO,KAAP;AACD;AAbF;AADD;;AAeA,WAAO,IAAP;AACA,GAlBuB,EAmBxB,CAACD,GAAD,CAnBwB,CAAzB;AAsBA,MAAMgG,mBAAmB,GAAG7G,KAAK,CAAC8F,WAAN,CAC3B,UAAA9D,MAAM,EAAI;AACT,QAAM8E,SAAS,GAAG5E,IAAI,CAACC,KAAL,CAAWD,IAAI,CAACE,SAAL,CAAeJ,MAAM,CAACd,KAAtB,CAAX,CAAlB;;AACA,QAAI6F,YAAY,sBAAO/E,MAAM,CAACK,GAAd,CAAhB;;AACA,WAAO0C,gBAAgB,CAAC,CAACgC,YAAY,CAAC,CAAD,CAAZ,GAAkB,CAAnB,EAAsBA,YAAY,CAAC,CAAD,CAAlC,CAAD,EAAyCD,SAAzC,CAAvB;AACCC,MAAAA,YAAY,GAAG,CAACA,YAAY,CAAC,CAAD,CAAZ,GAAkB,CAAnB,EAAsBA,YAAY,CAAC,CAAD,CAAlC,CAAf;AADD;;AAEA,WAAO;AAAE1E,MAAAA,GAAG,EAAE0E,YAAP;AAAqB7F,MAAAA,KAAK,EAAE4F;AAA5B,KAAP;AACA,GAP0B,EAQ3B,CAAC/B,gBAAD,CAR2B,CAA5B;AAWA,MAAML,eAAe,GAAG1E,KAAK,CAAC8F,WAAN,CACvB,UAAAkB,QAAQ,EAAI;AACX,QAAIvC,MAAJ;AACA,QAAI,CAACzC,MAAL,EAAa;AACb,QAAIgF,QAAQ,KAAK,MAAjB,EAAyBvC,MAAM,GAAG,CAACzC,MAAM,CAACK,GAAP,CAAW,CAAX,IAAgB,CAAjB,EAAoBL,MAAM,CAACK,GAAP,CAAW,CAAX,CAApB,CAAT;AACzB,QAAI2E,QAAQ,KAAK,MAAjB,EAAyBvC,MAAM,GAAG,CAACzC,MAAM,CAACK,GAAP,CAAW,CAAX,CAAD,EAAgBL,MAAM,CAACK,GAAP,CAAW,CAAX,IAAgB,CAAhC,CAAT;AACzB,QAAI2E,QAAQ,KAAK,OAAjB,EAA0BvC,MAAM,GAAG,CAACzC,MAAM,CAACK,GAAP,CAAW,CAAX,CAAD,EAAgBL,MAAM,CAACK,GAAP,CAAW,CAAX,IAAgB,CAAhC,CAAT;AAC1B,QAAI,CAAC0C,gBAAgB,CAACN,MAAD,EAASzC,MAAM,CAACd,KAAhB,CAArB,EAA6C,OAAOc,MAAM,CAACK,GAAd;AAC7C,WAAOoC,MAAP;AACA,GATsB,EAUvB,CAACzC,MAAD,EAAS+C,gBAAT,CAVuB,CAAxB;AAaAzE,EAAAA,WAAW,CACV,YAAM;AACLkE,IAAAA,IAAI;AACJ,GAHS,EAIT7B,KAAK,IAAIoB,QAAV,GAAsB,IAAtB,GAA6BtB,IAAI,GAAG,EAAH,GAAQ,MAAM,CAACgB,KAAK,GAAG,CAAT,IAAc,EAJnD,CAAX;AAOAvD,EAAAA,SAAS,CAAC,YAAM;AACf,QAAI,CAAC8B,MAAL,EAAa;AACbkB,IAAAA,aAAa,CAAC2D,mBAAmB,CAAC7E,MAAD,CAApB,CAAb;AACA,GAHQ,EAGN,CAACA,MAAD,EAAS6E,mBAAT,CAHM,CAAT;AAKA,MAAMI,IAAI,GAAG9G,OAAO,CACnB,iBAA4C;AAAA,QAAzCsC,IAAyC,SAAzCA,IAAyC;AAAA,8CAAnCuE,QAAmC;AAAA,QAAxBE,EAAwB;AAAA,QAApBC,EAAoB;AAAA,QAAfC,QAAe,SAAfA,QAAe;;AAC3C,QAAM1B,SAAS,GAAG,EAAlB;AACA,QAAM2B,eAAe,GAAG,CAAxB;;AACA,QAAI5E,IAAJ,EAAU;AACT,UAAId,IAAI,CAAC2F,GAAL,CAASJ,EAAE,GAAGvD,KAAd,IAAuB+B,SAA3B,EAAsC;AACrC,YAAIwB,EAAE,GAAGvD,KAAL,GAAa,CAAjB,EACCnB,SAAS,CAAC,UAAAR,MAAM;AAAA,mCAAUA,MAAV;AAAkBK,YAAAA,GAAG,EAAEqC,eAAe,CAAC,OAAD;AAAtC;AAAA,SAAP,CAAT,CADD,KAEKlC,SAAS,CAAC,UAAAR,MAAM;AAAA,mCAAUA,MAAV;AAAkBK,YAAAA,GAAG,EAAEqC,eAAe,CAAC,MAAD;AAAtC;AAAA,SAAP,CAAT;AACLd,QAAAA,QAAQ,CAACsD,EAAD,CAAR;AACA;;AACD,UAAIvF,IAAI,CAAC2F,GAAL,CAASH,EAAE,GAAGtD,KAAd,IAAuB6B,SAA3B,EAAsC;AACrC,YAAI0B,QAAQ,GAAGC,eAAf,EAAgC;AAC/B,cAAIlE,aAAJ,EAAmB;AAClBC,YAAAA,gBAAgB,CAAC,KAAD,CAAhB;AACAuC,YAAAA,WAAW;AACX;AACD,SALD,MAKO,IAAIwB,EAAE,GAAGtD,KAAL,GAAa,CAAjB,EAAoBW,IAAI;;AAC/BV,QAAAA,QAAQ,CAACqD,EAAD,CAAR;AACA;AACD,KAhBD,MAgBO;AACNvD,MAAAA,QAAQ,CAAC,CAAD,CAAR;AACAE,MAAAA,QAAQ,CAAC,CAAD,CAAR;AACAV,MAAAA,gBAAgB,CAAC,IAAD,CAAhB;AACA;AACD,GAzBkB,EA0BnB;AAAEmE,IAAAA,UAAU,EAAE,IAAd;AAAoBC,IAAAA,aAAa,EAAE;AAAnC,GA1BmB,CAApB;AA6BA,MAAI,CAACxF,MAAD,IAAW,CAACnB,GAAZ,IAAmB,CAACoC,UAAxB,EACC,OACC,oBAAC,MAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACC,oBAAC,SAAD;AAAW,IAAA,KAAK,EAAE,SAAlB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IADD,CADD;AAKD,SACC,oBAAC,KAAD;AACC,IAAA,IAAI,EAAEc,QADP;AAEC,IAAA,YAAY,EAAE;AAAA,aAAMO,WAAW,EAAjB;AAAA,KAFf;AAGC,IAAA,GAAG,EAAEzD,GAHN;AAIC,IAAA,MAAM,EAAEmB,MAJT;AAKC,IAAA,IAAI,EAAEiB,UALP;AAMC,IAAA,MAAM,EAAEN,KANT;AAOC,IAAA,MAAM,EAAE;AAAEU,MAAAA,KAAK,EAALA,KAAF;AAASE,MAAAA,KAAK,EAALA,KAAT;AAAgBE,MAAAA,KAAK,EAALA;AAAhB,KAPT;AAQC,IAAA,MAAM,EAAE;AAAA,aAAMb,QAAQ,CAAC,IAAD,CAAd;AAAA,KART;AASC,IAAA,OAAO,EAAE;AAAA,aAAMA,QAAQ,CAAC,KAAD,CAAd;AAAA,KATV;AAUC,IAAA,QAAQ,EAAC,GAVV;AAWC,IAAA,OAAO,EAAE4C,KAXV;AAYC,IAAA,SAAS,EAAEK,OAZZ;AAaC,IAAA,OAAO,EAAE;AAAA,aAAMb,YAAY,EAAlB;AAAA;AAbV,KAcKiC,IAAI,EAdT;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KADD;AAkBA,CA9QD;;AAgRA,eAAe3E,IAAf","sourcesContent":["import React, { useState, useEffect } from \"react\";\nimport { useDrag } from \"react-use-gesture\";\nimport BarLoader from \"react-spinners/BarLoader\";\n\nimport Stage from \"../Stage\";\nimport { useInterval } from \"../../hooks/useInterval\";\nimport Center from \"../Center\";\n\nimport { PrintPlayerInMap } from \"../../utils/Utils\";\n\n//TODO: Alterar OnClick (rotatePlayer) para OnFastClick (criar hook)\n//TODO: Organização do componente \"Game\" (Separar codigo em hooks, outros components e funcoes)\n//TODO: Dar um tempo quando o bloco estiver no chão, mas o usuário mexendo\n\nconst STAGE_HEIGHT = 18;\nconst STAGE_WIDTH = 10;\n\nconst initialMap = [...new Array(STAGE_HEIGHT)].map(() =>\n\t[...new Array(STAGE_WIDTH)].map(() => ({ fill: 0, color: [] }))\n);\n\nconst colors = [\n\t\"#e54b4b\",\n\t\"#9a031e\",\n\t\"#fcdc4d\",\n\t\"#005397\",\n\t\"#0bbcd6\",\n\t\"#20ad65\",\n\t\"#f8ebee\"\n];\n\nconst I = {\n\tbloco: [\n\t\t[0, 0, 0, 0],\n\t\t[1, 1, 1, 1],\n\t\t[0, 0, 0, 0],\n\t\t[0, 0, 0, 0]\n\t]\n};\n\nconst O = {\n\tbloco: [\n\t\t[1, 1],\n\t\t[1, 1]\n\t]\n};\n\nconst T = {\n\tbloco: [\n\t\t[0, 0, 0],\n\t\t[1, 1, 1],\n\t\t[0, 1, 0]\n\t]\n};\n\nconst J = {\n\tbloco: [\n\t\t[0, 1, 0],\n\t\t[0, 1, 0],\n\t\t[1, 1, 0]\n\t]\n};\n\nconst L = {\n\tbloco: [\n\t\t[0, 1, 0],\n\t\t[0, 1, 0],\n\t\t[0, 1, 1]\n\t]\n};\n\nconst S = {\n\tbloco: [\n\t\t[0, 1, 1],\n\t\t[1, 1, 0],\n\t\t[0, 0, 0]\n\t]\n};\n\nconst Z = {\n\tbloco: [\n\t\t[1, 1, 0],\n\t\t[0, 1, 1],\n\t\t[0, 0, 0]\n\t]\n};\n\nconst getRandomBloco = () => {\n\tconst blocos = [I, O, T, J, L, S, Z];\n\tconst bloco = blocos[Math.floor(Math.random() * blocos.length)];\n\tbloco.color = colors[Math.floor(Math.random() * colors.length)];\n\treturn bloco;\n};\nconst getRandomPlayer = player => {\n\tlet bloco, next;\n\tif (player)\n\t\tif (player.next) {\n\t\t\tbloco = JSON.parse(JSON.stringify(player.next));\n\t\t\tnext = getRandomBloco();\n\t\t}\n\tif (!bloco) bloco = getRandomBloco();\n\tif (!next) next = getRandomBloco();\n\tconst pos = [0, Math.floor(STAGE_WIDTH / 2 - 2 / 2)];\n\treturn { pos, bloco, next };\n};\n\nconst Game = () => {\n\tconst [map, setMap] = useState(initialMap);\n\tconst [player, setPlayer] = useState();\n\tconst [down, setDown] = useState(false);\n\tconst [pause, setPause] = useState(false);\n\tconst [tick, setTick] = useState(Date.now());\n\tconst [hintPlayer, setHintPlayer] = useState();\n\tconst [spaceReleased, setSpaceReleased] = useState(true);\n\tconst [lines, setlines] = useState(0);\n\tconst [score, setScore] = useState(0);\n\tconst [level, setLevel] = useState(1);\n\tconst [dragX, setDragX] = useState(0);\n\tconst [dragY, setDragY] = useState(0);\n\tconst [gameOver, setGameOver] = useState(false);\n\n\tuseEffect(() => {\n\t\tconst levelBaseScore = 1000;\n\t\tconst nextLevel = level + 1;\n\t\tconst nextLevelScore =\n\t\t\t(levelBaseScore * nextLevel * nextLevel * nextLevel) / 5;\n\t\tconsole.log(\"Current level: \", level);\n\t\tconsole.log(\"Score to next level:\", nextLevelScore);\n\t\tconsole.log(\"Remaining: \", nextLevelScore - score);\n\t\tif (score >= nextLevelScore) setLevel(level + 1);\n\t}, [level, score]);\n\n\tconst restartGame = () => {\n\t\tsetMap(initialMap); //TODO: lose game\n\t\tsetlines(0);\n\t\tsetScore(0);\n\t\tsetLevel(1);\n\t\tsetGameOver(false);\n\t}\n\n\tconst loseGame = () => {\n\t\tsetGameOver(true);\n\t};\n\n\tconst drop = () => {\n\t\tif (!player) {\n\t\t\tsetPlayer(getRandomPlayer());\n\t\t\treturn;\n\t\t}\n\t\tsetPlayer(player => {\n\t\t\tconst newPos = getNewPlayerPos(\"down\");\n\t\t\tif (player.pos === newPos) {\n\t\t\t\tsetMap(map => {\n\t\t\t\t\tconst mapWithPlayer = PrintPlayerInMap(player, map);\n\t\t\t\t\tconst mapCleared = checkMap(mapWithPlayer);\n\t\t\t\t\treturn mapCleared;\n\t\t\t\t});\n\t\t\t\tconst newPlayer = getRandomPlayer(player);\n\t\t\t\tif (!validatePosition(newPlayer.pos, newPlayer.bloco)) loseGame();\n\t\t\t\treturn newPlayer;\n\t\t\t}\n\t\t\treturn { ...player, pos: newPos };\n\t\t});\n\t};\n\n\tconst rotatePlayer = () => {\n\t\tconst clonedPlayer = JSON.parse(JSON.stringify(player));\n\t\tlet mtrx = clonedPlayer.bloco.bloco.map((_, index) =>\n\t\t\tclonedPlayer.bloco.bloco.map(column => column[index])\n\t\t);\n\t\tmtrx = mtrx.map(row => row.reverse());\n\t\tif (validatePosition(player.pos, { bloco: mtrx }))\n\t\t\tsetPlayer({ ...player, bloco: { ...player.bloco, bloco: mtrx } });\n\t};\n\n\tconst keyUp = ({ keyCode }) => {\n\t\tif (pause || gameOver)\n\t\t\treturn;\n\t\tconst THRESHOLD = 80;\n\t\t// Activate the interval again when user releases down arrow.\n\t\tif (keyCode === 40) {\n\t\t\tsetDown(false);\n\t\t\tif (Date.now() - tick <= THRESHOLD) drop();\n\t\t}\n\t\tif (keyCode === 32) setSpaceReleased(true);\n\t};\n\n\tconst forwardDown = () => {\n\t\tif (pause || gameOver)\n\t\t\treturn;\n\t\tsetPlayer(player => {\n\t\t\tconst playerCopy = JSON.parse(JSON.stringify(player));\n\t\t\tplayerCopy.pos = [...hintPlayer.pos];\n\t\t\tsetMap(map => {\n\t\t\t\tconst mapWithPlayer = PrintPlayerInMap(playerCopy, map);\n\t\t\t\tconst mapCleared = checkMap(mapWithPlayer);\n\t\t\t\treturn mapCleared;\n\t\t\t});\n\t\t\tconst newPlayer = getRandomPlayer(player);\n\t\t\tif (!validatePosition(newPlayer.pos, newPlayer.bloco)) loseGame();\n\t\t\treturn newPlayer;\n\t\t});\n\t};\n\n\tconst keyDown = ({ keyCode }) => {\n\t\tif (pause || gameOver)\n\t\t\treturn;\n\t\tswitch (keyCode) {\n\t\t\tcase 37:\n\t\t\t\tsetPlayer(player => ({ ...player, pos: getNewPlayerPos(\"left\") }));\n\t\t\t\tbreak;\n\t\t\tcase 38:\n\t\t\t\trotatePlayer();\n\t\t\t\tbreak;\n\t\t\tcase 39:\n\t\t\t\tsetPlayer(player => ({ ...player, pos: getNewPlayerPos(\"right\") }));\n\t\t\t\tbreak;\n\t\t\tcase 40:\n\t\t\t\tsetTick(Date.now());\n\t\t\t\tsetDown(true);\n\t\t\t\tbreak;\n\t\t\tcase 32:\n\t\t\t\tif (spaceReleased) {\n\t\t\t\t\tsetSpaceReleased(false);\n\t\t\t\t\tforwardDown();\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tbreak;\n\t\t}\n\t};\n\n\tconst checkMap = React.useCallback(\n\t\tmap => {\n\t\t\tlet rowsClear = [];\n\t\t\tmap.forEach((row, y) => {\n\t\t\t\tlet clear = true;\n\t\t\t\trow.forEach((pixel, x) => {\n\t\t\t\t\tif (pixel.fill === 0) clear = false;\n\t\t\t\t});\n\t\t\t\tif (clear) rowsClear.push(y);\n\t\t\t});\n\t\t\tif (rowsClear.length > 0) {\n\t\t\t\tlet newMap = map.slice();\n\t\t\t\trowsClear.forEach(y => {\n\t\t\t\t\tfor (let mapY = newMap.length - 1; mapY >= 0; mapY--)\n\t\t\t\t\t\tif (mapY <= y)\n\t\t\t\t\t\t\tif (mapY > 0) newMap[mapY] = newMap[mapY - 1];\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\tnewMap[mapY] = [...new Array(STAGE_WIDTH)].map(() => ({\n\t\t\t\t\t\t\t\t\tfill: 0,\n\t\t\t\t\t\t\t\t\tcolor: []\n\t\t\t\t\t\t\t\t}));\n\t\t\t\t});\n\t\t\t\tsetlines(quant => quant + rowsClear.length);\n\t\t\t\tconst bonusLevel = 100 * (level * level);\n\t\t\t\tconst bonusRows = 40 * (rowsClear.length * rowsClear.length - 1);\n\t\t\t\tsetScore(score => score + 300 * rowsClear.length + bonusRows + bonusLevel);\n\t\t\t\treturn newMap;\n\t\t\t}\n\t\t\treturn map;\n\t\t},\n\t\t[level]\n\t);\n\n\tconst validatePosition = React.useCallback(\n\t\t(pos, bloco) => {\n\t\t\tfor (let y = 0; y < bloco.bloco.length; y++)\n\t\t\t\tfor (let x = 0; x < bloco.bloco[y].length; x++)\n\t\t\t\t\tif (bloco.bloco[y][x] === 1) {\n\t\t\t\t\t\tlet mapY = pos[0] + y;\n\t\t\t\t\t\tlet mapX = pos[1] + x;\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\tmapY > STAGE_HEIGHT ||\n\t\t\t\t\t\t\tmapX < 0 ||\n\t\t\t\t\t\t\tmapX > STAGE_WIDTH ||\n\t\t\t\t\t\t\t!map[mapY] ||\n\t\t\t\t\t\t\t!map[mapY][mapX] ||\n\t\t\t\t\t\t\tmap[mapY][mapX].fill === 1\n\t\t\t\t\t\t)\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\treturn true;\n\t\t},\n\t\t[map]\n\t);\n\n\tconst calculateHintPlayer = React.useCallback(\n\t\tplayer => {\n\t\t\tconst hintBloco = JSON.parse(JSON.stringify(player.bloco));\n\t\t\tlet hintPosition = [...player.pos];\n\t\t\twhile (validatePosition([hintPosition[0] + 1, hintPosition[1]], hintBloco))\n\t\t\t\thintPosition = [hintPosition[0] + 1, hintPosition[1]];\n\t\t\treturn { pos: hintPosition, bloco: hintBloco };\n\t\t},\n\t\t[validatePosition]\n\t);\n\n\tconst getNewPlayerPos = React.useCallback(\n\t\tmovement => {\n\t\t\tlet newPos;\n\t\t\tif (!player) return;\n\t\t\tif (movement === \"down\") newPos = [player.pos[0] + 1, player.pos[1]];\n\t\t\tif (movement === \"left\") newPos = [player.pos[0], player.pos[1] - 1];\n\t\t\tif (movement === \"right\") newPos = [player.pos[0], player.pos[1] + 1];\n\t\t\tif (!validatePosition(newPos, player.bloco)) return player.pos;\n\t\t\treturn newPos;\n\t\t},\n\t\t[player, validatePosition]\n\t);\n\n\tuseInterval(\n\t\t() => {\n\t\t\tdrop();\n\t\t},\n\t\t(pause || gameOver) ? null : down ? 50 : 450 - (level - 1) * 20\n\t);\n\n\tuseEffect(() => {\n\t\tif (!player) return;\n\t\tsetHintPlayer(calculateHintPlayer(player));\n\t}, [player, calculateHintPlayer]);\n\n\tconst bind = useDrag(\n\t\t({ down, movement: [mx, my], velocity }) => {\n\t\t\tconst THRESHOLD = 20;\n\t\t\tconst FORCE_THRESHOLD = 1;\n\t\t\tif (down) {\n\t\t\t\tif (Math.abs(mx - dragX) > THRESHOLD) {\n\t\t\t\t\tif (mx - dragX > 0)\n\t\t\t\t\t\tsetPlayer(player => ({ ...player, pos: getNewPlayerPos(\"right\") }));\n\t\t\t\t\telse setPlayer(player => ({ ...player, pos: getNewPlayerPos(\"left\") }));\n\t\t\t\t\tsetDragX(mx);\n\t\t\t\t}\n\t\t\t\tif (Math.abs(my - dragY) > THRESHOLD) {\n\t\t\t\t\tif (velocity > FORCE_THRESHOLD) {\n\t\t\t\t\t\tif (spaceReleased) {\n\t\t\t\t\t\t\tsetSpaceReleased(false);\n\t\t\t\t\t\t\tforwardDown();\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if (my - dragY > 0) drop();\n\t\t\t\t\tsetDragY(my);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tsetDragX(0);\n\t\t\t\tsetDragY(0);\n\t\t\t\tsetSpaceReleased(true);\n\t\t\t}\n\t\t},\n\t\t{ filterTaps: true, lockDirection: true }\n\t);\n\n\tif (!player || !map || !hintPlayer)\n\t\treturn (\n\t\t\t<Center>\n\t\t\t\t<BarLoader color={\"#C41212\"} />\n\t\t\t</Center>\n\t\t);\n\treturn (\n\t\t<Stage\n\t\t\tlose={gameOver}\n\t\t\trestartClick={() => restartGame()}\n\t\t\tmap={map}\n\t\t\tplayer={player}\n\t\t\thint={hintPlayer}\n\t\t\tpaused={pause}\n\t\t\tstatus={{ lines, score, level }}\n\t\t\tonBlur={() => setPause(true)}\n\t\t\tonFocus={() => setPause(false)}\n\t\t\ttabIndex=\"0\"\n\t\t\tonKeyUp={keyUp}\n\t\t\tonKeyDown={keyDown}\n\t\t\tonClick={() => rotatePlayer()}\n\t\t\t{...bind()}\n\t\t/>\n\t);\n};\n\nexport default Game;\n"]},"metadata":{},"sourceType":"module"}